<template>
  <div class="helloCanvas">
    <div class="canvasBox">
      <div class="box-left">
        <div class="canvas-tab-top">
          <div class="tools-left">
            <router-link to="/canvas/paintBrush">
              <div class="change-block">
                <div class="listTitle">
                  <div class="leading">
                    <svg
                      t="1613796015735"
                      class="icon"
                      viewBox="0 0 1217 1024"
                      version="1.1"
                      xmlns="http://www.w3.org/2000/svg"
                      p-id="1958"
                      width="48"
                      height="48"
                    >
                      <path
                        d="M441.759135 795.897081a34.594595 34.594595 0 0 1 63.930811 26.43027c-6.199351 15.027892-18.874811 35.369514-39.880649 55.48973-30.636973 29.336216-70.46227 48.570811-119.475892 52.583784a34.594595 34.594595 0 0 1-5.645837-68.940108c32.463568-2.684541 57.648432-14.834162 77.24281-33.598271 11.789838-11.264 19.234595-22.361946 22.694054-29.50227l1.134703-2.490811zM492.682378 502.451892a34.594595 34.594595 0 0 1 46.135352-2.490811l2.795243 2.490811 151.939459 151.939459a34.594595 34.594595 0 0 1-46.107675 51.476757l-2.795243-2.546162-151.93946-151.93946a34.594595 34.594595 0 0 1 0-48.930594z"
                        fill="#5AC2EE"
                        p-id="1959"
                      ></path>
                      <path
                        d="M1000.143568 52.860541C1052.256865 7.057297 1129.167568 0.719568 1173.088865 43.727568c42.980324 42.122378 38.164757 115.269189-5.009297 166.496864l-4.317406 4.898595-398.944865 435.283027-157.114811 153.876757-0.166054 3.957621c-3.127351 46.799568-23.911784 90.803892-60.277621 128.747244l-5.867243 5.922594c-47.408432 46.605838-123.461189 68.718703-220.519784 73.478919-58.700108 2.905946-121.108757-0.83027-182.438054-8.745513a1185.044757 1185.044757 0 0 1-36.670271-5.31373l-15.636756-2.656865-9.907892-1.85427-64.733406-13.007568 47.546811-45.803243c0.968649-0.940973 2.739892-2.767568 5.258379-5.479784l4.289729-4.73254c8.38573-9.40973 17.850811-20.895135 28.090811-34.483892 29.640649-39.382486 59.447351-87.593514 87.344433-144.937514a1117.709838 1117.709838 0 0 0 41.59654-97.141621c26.43027-70.572973 101.209946-95.42573 185.288649-78.239135l7.472432 1.66054 9.40973 2.186378 156.118486 152.908109 107.298595-105.056865-162.096432-158.803027 471.04-414.028108zM389.756541 640.415135c-50.646486-8.579459-87.731892 4.981622-99.355676 36.089081a1186.788324 1186.788324 0 0 1-44.170379 103.119568c-27.398919 56.32-56.679784 104.724757-86.237405 145.408l-8.053622 10.904216-2.546162 3.321081 17.158919 2.103351a981.656216 981.656216 0 0 0 132.732541 6.586811l18.210594-0.664216c81.643243-4.012973 142.972541-21.863784 175.436108-53.718486 32.629622-32.048432 47.93427-67.722378 45.581838-105.444325l-0.498162-5.452108-144.494703-141.561081-3.763891-0.691892zM1124.656432 93.184c-14.612757-14.308324-48.017297-12.371027-74.475243 8.081297l-4.345081 3.570162L630.728649 469.628541l108.516324 106.30227L1112.755892 168.378811c22.638703-24.686703 26.485622-56.956541 14.114594-72.731676l-2.214054-2.490811z"
                        fill="#5AC2EE"
                        p-id="1960"
                      ></path>
                    </svg>
                  </div>
                  <div class="text">画笔</div>
                </div>
              </div>
            </router-link>
            <router-link to="/canvas/2dShape">
              <div class="change-block">
                <div class="listTitle">
                  <div class="leading">
                    <svg
                      t="1613796199617"
                      class="icon"
                      viewBox="0 0 1024 1024"
                      version="1.1"
                      xmlns="http://www.w3.org/2000/svg"
                      p-id="4740"
                      width="48"
                      height="48"
                    >
                      <path
                        d="M306.00499 0.05769L0 0l0.05563 306.00499L87.412926 87.412926zM717.99501 1023.94437L1024 1024l-0.05563-306.00499-87.357296 218.592064zM0.05769 717.99501L0 1024l306.00499-0.05563-218.592064-87.357296zM1023.94437 306.00499L1024 0 717.99501 0.05563l218.592064 87.357296z"
                        fill="#10BEFF"
                        p-id="4741"
                      ></path>
                      <path
                        d="M980.293537 980.293537l43.650833-262.298527-65.560724 65.560724-158.674672-158.674672c13.773521-34.98495 21.345352-73.064563 21.345352-112.881062 0-39.816499-7.571831-77.896113-21.345352-112.881062l158.674672-158.674672 65.560724 65.560724-43.650833-262.298527L717.99501 0.05563l65.560724 65.560724-158.674672 158.674672c-34.98495-13.773521-73.064563-21.345352-112.881062-21.345352-39.816499 0-77.896113 7.571831-112.881062 21.345352L240.444266 65.616354 306.00499 0.05563 43.706463 43.706463 0.05563 306.00499l65.560724-65.560724 158.674672 158.674672c-13.773521 34.98495-21.345352 73.064563-21.345352 112.881062 0 39.816499 7.571831 77.896113 21.345352 112.881062L65.616354 783.555734 0.05563 717.99501l43.650833 262.298527 262.298527 43.650833-65.560724-65.560724 158.674672-158.674672c34.98495 13.773521 73.064563 21.345352 112.881062 21.345352 39.816499 0 77.896113-7.571831 112.881062-21.345352l158.674672 158.674672-65.560724 65.560724 262.298527-43.650833z"
                        fill="#08E2FF"
                        p-id="4742"
                      ></path>
                      <path
                        d="M512 512m-247.243461 0a247.243461 247.243461 0 1 0 494.486922 0 247.243461 247.243461 0 1 0-494.486922 0Z"
                        fill="#FF451B"
                        p-id="4743"
                      ></path>
                      <path
                        d="M512 326.567404v370.865192c102.247533 0 185.432596-83.185062 185.432596-185.432596s-83.185062-185.432596-185.432596-185.432596z"
                        fill="#D6FAFF"
                        p-id="4744"
                      ></path>
                      <path
                        d="M635.62173 512c0-102.247533-55.456708-185.432596-123.62173-185.432596-102.247533 0-185.432596 83.185062-185.432596 185.432596s83.185062 185.432596 185.432596 185.432596c68.165022 0 123.62173-83.185062 123.62173-185.432596z"
                        fill="#FFFFFF"
                        p-id="4745"
                      ></path>
                    </svg>
                  </div>
                  <div class="text">2D形状</div>
                </div>
              </div>
            </router-link>
            <router-link to="/canvas/drawingBorad">
              <div class="change-block">
                <div class="listTitle">
                  <div class="leading">
                    <svg
                      t="1613796147325"
                      class="icon"
                      viewBox="0 0 1024 1024"
                      version="1.1"
                      xmlns="http://www.w3.org/2000/svg"
                      p-id="3178"
                      width="48"
                      height="48"
                    >
                      <path
                        d="M745.192727 412.858182l-0.232727 0.232727v-0.232727h0.232727zM686.778182 314.414545v535.272728h-488.727273a139.636364 139.636364 0 0 1-139.636364-139.636364v-395.636364z"
                        fill="#BAD9FF"
                        p-id="3179"
                      ></path>
                      <path
                        d="M826.414545 360.96h93.09091a46.545455 46.545455 0 0 1 46.545454 46.545455v232.727272a46.545455 46.545455 0 0 1-46.545454 46.545455h-93.09091v-325.818182z"
                        fill="#1474E4"
                        p-id="3180"
                      ></path>
                      <path
                        d="M686.778182 174.778182v139.636363h-628.363637v-116.363636a23.272727 23.272727 0 0 1 23.272728-23.272727z"
                        fill="#73B4FF"
                        p-id="3181"
                      ></path>
                      <path
                        d="M826.414545 198.050909v116.363636h-139.636363v-139.636363h116.363636a23.272727 23.272727 0 0 1 23.272727 23.272727z"
                        fill="#1474E4"
                        p-id="3182"
                      ></path>
                      <path
                        d="M826.414545 314.414545v395.636364a139.636364 139.636364 0 0 1-139.636363 139.636364v-535.272728z"
                        fill="#73B4FF"
                        p-id="3183"
                      ></path>
                    </svg>
                  </div>
                  <div class="text">画布</div>
                </div>
              </div>
            </router-link>
          </div>
          <div class="tools-right">
            <div class="reduceBtn" @click="reduceSlider">－</div>
            <div class="block">
              <el-slider v-model="sliderValue" :max="500" @change="sliderChange"></el-slider>
            </div>
            <div class="addBtn" @click="addSlider">＋</div>
            <div class="percentage">{{ sliderValue }}%</div>
            <div class="last" @click="last">
              <svg
                t="1613806497371"
                class="icon"
                viewBox="0 0 1114 1024"
                version="1.1"
                xmlns="http://www.w3.org/2000/svg"
                p-id="9411"
                width="48"
                height="48"
              >
                <path
                  d="M545.879102 513.350337c-4.052766-18.012293 9.006146-37.825814 23.506041-52.235649l445.353933-444.183133a57.90952 57.90952 0 1 1 81.865869 82.136054L672.775702 512.35966l423.829243 412.57156a57.819459 57.819459 0 0 1-40.887904 99.067609 57.729397 57.729397 0 0 1-40.887904-16.931555L569.385143 563.514571C557.136784 549.374922 542.817012 531.362629 545.879102 513.350337z"
                  fill="#467CFD"
                  p-id="9412"
                ></path>
                <path
                  d="M24.333172 461.20475L469.597043 16.931555A57.90952 57.90952 0 1 1 551.462912 99.067609L127.723731 512.35966l423.829243 412.57156a57.819459 57.819459 0 0 1-40.887904 99.067609 57.729397 57.729397 0 0 1-40.887904-16.931555L24.333172 563.514571C11.994752 549.374922-2.325021 531.362629 0.737069 513.350337c-4.052766-18.012293 9.276331-37.825814 23.596103-52.145587z"
                  fill="#467CFD"
                  p-id="9413"
                ></path>
              </svg>
            </div>
            <div class="next" @click="next">
              <svg
                t="1613806511772"
                class="icon"
                viewBox="0 0 1114 1024"
                version="1.1"
                xmlns="http://www.w3.org/2000/svg"
                p-id="9653"
                width="48"
                height="48"
              >
                <path
                  d="M567.766539 513.435009c4.052808-18.012479-9.00624-37.826207-23.506286-52.23619L99.442074 17.011076A57.910121 57.910121 0 0 0 17.305167 99.147982l423.743579 413.296341-423.743579 412.485779a57.820059 57.820059 0 0 0 40.888329 99.068637 57.729997 57.729997 0 0 0 41.248578-17.111855l444.998304-443.28712C556.778927 549.459968 571.098848 531.447489 567.766539 513.435009z"
                  fill="#467CFD"
                  p-id="9654"
                ></path>
                <path
                  d="M1089.588069 461.288881L644.319577 17.011076A57.910121 57.910121 0 0 0 562.362795 99.147982l423.833642 413.566528-423.833642 412.215592a57.820059 57.820059 0 0 0 40.888329 99.068637 57.729997 57.729997 0 0 0 40.888328-16.931731l445.268492-443.287119c12.248486-14.319921 27.018719-31.701964 23.506286-50.164755 4.232933-18.192604-9.00624-38.006332-23.326161-52.326253z"
                  fill="#467CFD"
                  p-id="9655"
                ></path>
              </svg>
            </div>
          </div>
        </div>

        <div class="content" ref="canvasContent">
          <canvas
            ref="canvas"
            class="canvas"
            :width="750 * (sliderValue / 100)"
            :height="400 * (sliderValue / 100)"
          >
            你的浏览器不支持canvas，请升级浏览器或者使用Chrome/fixfor
          </canvas>
        </div>
      </div>
      <div class="box-right">
        <transition>
          <router-view></router-view>
        </transition>
      </div>
    </div>
  </div>
</template>

<script lang="ts">
import { Component, Vue, Ref } from 'vue-property-decorator'
import '../style/components/canvas.scss'
@Component
export default class HelloWorld extends Vue {
  @Ref() private canvas!: any;
  @Ref() private canvasContent!: any;
  private sliderValue = 100;
  private ctx: any;
  private x = 0;
  private y = 0;
  private strokeStyle: any = 'blue';
  private lineWidth = 1;
  private isDash = false;
  private imageDataArr: any = [];
  private step = 0;
  mounted () {
    this.init()
  }

  init () {
    this.ctx = this.canvas.getContext('2d')
    this.canvas.onmousedown = (e: any) => {
      this.ctx.beginPath()
      this.x =
        e.clientX - this.canvas.offsetLeft + this.canvasContent.scrollLeft
      this.y = e.clientY - this.canvas.offsetTop + this.canvasContent.scrollTop
      this.ctx.moveTo(this.x, this.y)
      this.ctx.strokeStyle = this.strokeStyle
      this.ctx.lineWidth = this.lineWidth
      this.ctx.strokeStyle = this.strokeStyle
      this.ctx.lineWidth = this.lineWidth
      if (!this.isDash) {
        this.ctx.setLineDash([10, 5]) // 虚线
      }
      this.canvas.onmousemove = (e: any) => {
        this.x =
          e.clientX - this.canvas.offsetLeft + this.canvasContent.scrollLeft
        this.y =
          e.clientY - this.canvas.offsetTop + this.canvasContent.scrollTop
        this.ctx.lineTo(this.x, this.y)
        this.ctx.stroke()
      }
      window.onmouseup = () => {
        this.canvas.onmousemove = null
        window.onmouseup = null
        this.ctx.closePath()
        this.imageDataArr.push(
          this.ctx.getImageData(
            0,
            0,
            this.canvas.offsetWidth,
            this.canvas.offsetHeight
          )
        )
        this.step = this.imageDataArr.length - 1
      }
    }
  }

  sliderChange () {
    if (this.imageDataArr.length <= 0) return
    this.ctx.putImageData(this.imageDataArr[this.step], 0, 0)
  }

  last () {
    this.step--
    if (this.step < 0) {
      this.step = 0
      this.ctx.clearRect(
        0,
        0,
        this.canvas.offsetWidth,
        this.canvas.offsetHeight
      )
      return false
    }
    this.ctx.putImageData(this.imageDataArr[this.step], 0, 0)
  }

  next () {
    this.step++
    if (this.step > this.imageDataArr.length - 1) {
      this.step = this.imageDataArr.length - 1
      return false
    }
    this.ctx.putImageData(this.imageDataArr[this.step], 0, 0)
  }

  reduceSlider () {
    this.sliderValue -= 10
  }

  addSlider () {
    this.sliderValue += 10
  }
}
</script>
