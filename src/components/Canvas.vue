<template>
  <div class="helloCanvas">
    <div class="canvasBox">
      <div class="box-left">
        <div class="canvas-tab-top">
          <div class="tools-left">
            <router-link to="/canvas/paintBrush">
              <div class="change-block">
                <div class="listTitle">
                  <div class="leading">
                    <svg
                      t="1613796015735"
                      class="icon"
                      viewBox="0 0 1217 1024"
                      version="1.1"
                      xmlns="http://www.w3.org/2000/svg"
                      p-id="1958"
                      width="48"
                      height="48"
                    >
                      <path
                        d="M441.759135 795.897081a34.594595 34.594595 0 0 1 63.930811 26.43027c-6.199351 15.027892-18.874811 35.369514-39.880649 55.48973-30.636973 29.336216-70.46227 48.570811-119.475892 52.583784a34.594595 34.594595 0 0 1-5.645837-68.940108c32.463568-2.684541 57.648432-14.834162 77.24281-33.598271 11.789838-11.264 19.234595-22.361946 22.694054-29.50227l1.134703-2.490811zM492.682378 502.451892a34.594595 34.594595 0 0 1 46.135352-2.490811l2.795243 2.490811 151.939459 151.939459a34.594595 34.594595 0 0 1-46.107675 51.476757l-2.795243-2.546162-151.93946-151.93946a34.594595 34.594595 0 0 1 0-48.930594z"
                        fill="#5AC2EE"
                        p-id="1959"
                      ></path>
                      <path
                        d="M1000.143568 52.860541C1052.256865 7.057297 1129.167568 0.719568 1173.088865 43.727568c42.980324 42.122378 38.164757 115.269189-5.009297 166.496864l-4.317406 4.898595-398.944865 435.283027-157.114811 153.876757-0.166054 3.957621c-3.127351 46.799568-23.911784 90.803892-60.277621 128.747244l-5.867243 5.922594c-47.408432 46.605838-123.461189 68.718703-220.519784 73.478919-58.700108 2.905946-121.108757-0.83027-182.438054-8.745513a1185.044757 1185.044757 0 0 1-36.670271-5.31373l-15.636756-2.656865-9.907892-1.85427-64.733406-13.007568 47.546811-45.803243c0.968649-0.940973 2.739892-2.767568 5.258379-5.479784l4.289729-4.73254c8.38573-9.40973 17.850811-20.895135 28.090811-34.483892 29.640649-39.382486 59.447351-87.593514 87.344433-144.937514a1117.709838 1117.709838 0 0 0 41.59654-97.141621c26.43027-70.572973 101.209946-95.42573 185.288649-78.239135l7.472432 1.66054 9.40973 2.186378 156.118486 152.908109 107.298595-105.056865-162.096432-158.803027 471.04-414.028108zM389.756541 640.415135c-50.646486-8.579459-87.731892 4.981622-99.355676 36.089081a1186.788324 1186.788324 0 0 1-44.170379 103.119568c-27.398919 56.32-56.679784 104.724757-86.237405 145.408l-8.053622 10.904216-2.546162 3.321081 17.158919 2.103351a981.656216 981.656216 0 0 0 132.732541 6.586811l18.210594-0.664216c81.643243-4.012973 142.972541-21.863784 175.436108-53.718486 32.629622-32.048432 47.93427-67.722378 45.581838-105.444325l-0.498162-5.452108-144.494703-141.561081-3.763891-0.691892zM1124.656432 93.184c-14.612757-14.308324-48.017297-12.371027-74.475243 8.081297l-4.345081 3.570162L630.728649 469.628541l108.516324 106.30227L1112.755892 168.378811c22.638703-24.686703 26.485622-56.956541 14.114594-72.731676l-2.214054-2.490811z"
                        fill="#5AC2EE"
                        p-id="1960"
                      ></path>
                    </svg>
                  </div>
                  <div class="text">画笔</div>
                </div>
              </div>
            </router-link>
            <router-link to="/canvas/2dShape">
              <div class="change-block">
                <div class="listTitle">
                  <div class="leading">
                    <svg
                      t="1613796199617"
                      class="icon"
                      viewBox="0 0 1024 1024"
                      version="1.1"
                      xmlns="http://www.w3.org/2000/svg"
                      p-id="4740"
                      width="48"
                      height="48"
                    >
                      <path
                        d="M306.00499 0.05769L0 0l0.05563 306.00499L87.412926 87.412926zM717.99501 1023.94437L1024 1024l-0.05563-306.00499-87.357296 218.592064zM0.05769 717.99501L0 1024l306.00499-0.05563-218.592064-87.357296zM1023.94437 306.00499L1024 0 717.99501 0.05563l218.592064 87.357296z"
                        fill="#10BEFF"
                        p-id="4741"
                      ></path>
                      <path
                        d="M980.293537 980.293537l43.650833-262.298527-65.560724 65.560724-158.674672-158.674672c13.773521-34.98495 21.345352-73.064563 21.345352-112.881062 0-39.816499-7.571831-77.896113-21.345352-112.881062l158.674672-158.674672 65.560724 65.560724-43.650833-262.298527L717.99501 0.05563l65.560724 65.560724-158.674672 158.674672c-34.98495-13.773521-73.064563-21.345352-112.881062-21.345352-39.816499 0-77.896113 7.571831-112.881062 21.345352L240.444266 65.616354 306.00499 0.05563 43.706463 43.706463 0.05563 306.00499l65.560724-65.560724 158.674672 158.674672c-13.773521 34.98495-21.345352 73.064563-21.345352 112.881062 0 39.816499 7.571831 77.896113 21.345352 112.881062L65.616354 783.555734 0.05563 717.99501l43.650833 262.298527 262.298527 43.650833-65.560724-65.560724 158.674672-158.674672c34.98495 13.773521 73.064563 21.345352 112.881062 21.345352 39.816499 0 77.896113-7.571831 112.881062-21.345352l158.674672 158.674672-65.560724 65.560724 262.298527-43.650833z"
                        fill="#08E2FF"
                        p-id="4742"
                      ></path>
                      <path
                        d="M512 512m-247.243461 0a247.243461 247.243461 0 1 0 494.486922 0 247.243461 247.243461 0 1 0-494.486922 0Z"
                        fill="#FF451B"
                        p-id="4743"
                      ></path>
                      <path
                        d="M512 326.567404v370.865192c102.247533 0 185.432596-83.185062 185.432596-185.432596s-83.185062-185.432596-185.432596-185.432596z"
                        fill="#D6FAFF"
                        p-id="4744"
                      ></path>
                      <path
                        d="M635.62173 512c0-102.247533-55.456708-185.432596-123.62173-185.432596-102.247533 0-185.432596 83.185062-185.432596 185.432596s83.185062 185.432596 185.432596 185.432596c68.165022 0 123.62173-83.185062 123.62173-185.432596z"
                        fill="#FFFFFF"
                        p-id="4745"
                      ></path>
                    </svg>
                  </div>
                  <div class="text">2D形状</div>
                </div>
              </div>
            </router-link>
            <router-link to="/canvas/drawingBorad">
              <div class="change-block">
                <div class="listTitle">
                  <div class="leading">
                    <svg
                      t="1613796147325"
                      class="icon"
                      viewBox="0 0 1024 1024"
                      version="1.1"
                      xmlns="http://www.w3.org/2000/svg"
                      p-id="3178"
                      width="48"
                      height="48"
                    >
                      <path
                        d="M745.192727 412.858182l-0.232727 0.232727v-0.232727h0.232727zM686.778182 314.414545v535.272728h-488.727273a139.636364 139.636364 0 0 1-139.636364-139.636364v-395.636364z"
                        fill="#BAD9FF"
                        p-id="3179"
                      ></path>
                      <path
                        d="M826.414545 360.96h93.09091a46.545455 46.545455 0 0 1 46.545454 46.545455v232.727272a46.545455 46.545455 0 0 1-46.545454 46.545455h-93.09091v-325.818182z"
                        fill="#1474E4"
                        p-id="3180"
                      ></path>
                      <path
                        d="M686.778182 174.778182v139.636363h-628.363637v-116.363636a23.272727 23.272727 0 0 1 23.272728-23.272727z"
                        fill="#73B4FF"
                        p-id="3181"
                      ></path>
                      <path
                        d="M826.414545 198.050909v116.363636h-139.636363v-139.636363h116.363636a23.272727 23.272727 0 0 1 23.272727 23.272727z"
                        fill="#1474E4"
                        p-id="3182"
                      ></path>
                      <path
                        d="M826.414545 314.414545v395.636364a139.636364 139.636364 0 0 1-139.636363 139.636364v-535.272728z"
                        fill="#73B4FF"
                        p-id="3183"
                      ></path>
                    </svg>
                  </div>
                  <div class="text">画布</div>
                </div>
              </div>
            </router-link>
          </div>
          <div class="tools-right">
            <div class="reduceBtn" @click="reduceSlider">－</div>
            <div class="block">
              <el-slider
                v-model="sliderValue"
                :max="500"
                @change="sliderChange"
                @input="sliderInput"
              ></el-slider>
            </div>
            <div class="addBtn" @click="addSlider">＋</div>
            <div class="percentage">{{ sliderValue }}%</div>
            <div class="last" @click="last" title="退一步">
              <svg
                t="1613806497371"
                class="icon"
                viewBox="0 0 1114 1024"
                version="1.1"
                xmlns="http://www.w3.org/2000/svg"
                p-id="9411"
                width="48"
                height="48"
              >
                <path
                  d="M545.879102 513.350337c-4.052766-18.012293 9.006146-37.825814 23.506041-52.235649l445.353933-444.183133a57.90952 57.90952 0 1 1 81.865869 82.136054L672.775702 512.35966l423.829243 412.57156a57.819459 57.819459 0 0 1-40.887904 99.067609 57.729397 57.729397 0 0 1-40.887904-16.931555L569.385143 563.514571C557.136784 549.374922 542.817012 531.362629 545.879102 513.350337z"
                  fill="#467CFD"
                  p-id="9412"
                ></path>
                <path
                  d="M24.333172 461.20475L469.597043 16.931555A57.90952 57.90952 0 1 1 551.462912 99.067609L127.723731 512.35966l423.829243 412.57156a57.819459 57.819459 0 0 1-40.887904 99.067609 57.729397 57.729397 0 0 1-40.887904-16.931555L24.333172 563.514571C11.994752 549.374922-2.325021 531.362629 0.737069 513.350337c-4.052766-18.012293 9.276331-37.825814 23.596103-52.145587z"
                  fill="#467CFD"
                  p-id="9413"
                ></path>
              </svg>
            </div>
            <div class="next" @click="next" title="重写">
              <svg
                t="1613806511772"
                class="icon"
                viewBox="0 0 1114 1024"
                version="1.1"
                xmlns="http://www.w3.org/2000/svg"
                p-id="9653"
                width="48"
                height="48"
              >
                <path
                  d="M567.766539 513.435009c4.052808-18.012479-9.00624-37.826207-23.506286-52.23619L99.442074 17.011076A57.910121 57.910121 0 0 0 17.305167 99.147982l423.743579 413.296341-423.743579 412.485779a57.820059 57.820059 0 0 0 40.888329 99.068637 57.729997 57.729997 0 0 0 41.248578-17.111855l444.998304-443.28712C556.778927 549.459968 571.098848 531.447489 567.766539 513.435009z"
                  fill="#467CFD"
                  p-id="9654"
                ></path>
                <path
                  d="M1089.588069 461.288881L644.319577 17.011076A57.910121 57.910121 0 0 0 562.362795 99.147982l423.833642 413.566528-423.833642 412.215592a57.820059 57.820059 0 0 0 40.888329 99.068637 57.729997 57.729997 0 0 0 40.888328-16.931731l445.268492-443.287119c12.248486-14.319921 27.018719-31.701964 23.506286-50.164755 4.232933-18.192604-9.00624-38.006332-23.326161-52.326253z"
                  fill="#467CFD"
                  p-id="9655"
                ></path>
              </svg>
            </div>
            <div class="clearCanvas" @click="clearCanvas" title="清空画布">
              <svg
                t="1613884559960"
                class="icon"
                viewBox="0 0 1024 1024"
                version="1.1"
                xmlns="http://www.w3.org/2000/svg"
                p-id="2044"
                width="48"
                height="48"
              >
                <path
                  d="M151.963012 337.651783v30.025437h22.107732l7.917705 60.050874c0 11.025197 3.281552 21.170877 8.473675 30.025438h673.634633c5.191099-8.85456 8.475723-19.00024 8.475723-30.025438l7.975043-60.050874h22.050394v-30.025437H151.963012zM269.365799 790.671893c5.512599 31.433279 25.626826 57.294575 57.294575 57.294575h401.238133c31.667749 0 50.845121-25.392356 57.354985-57.294575l51.869006-302.892924h-619.686115l51.929416 302.892924z m146.373622-228.414482l21.231286-21.231286 90.310781 90.253444 90.310782-90.253444 21.228214 21.231286-90.310781 90.250372 90.604636 90.604636-21.231286 21.228215-90.601565-90.604636-90.604636 90.604636-21.228214-21.228215 90.602588-90.604636-90.311805-90.250372z"
                  fill="#98C4D8"
                  p-id="2045"
                ></path>
                <path
                  d="M121.937575 307.626346v30.025437h22.107732l7.917705 60.050874c0 11.025197 3.281552 21.170877 8.473675 30.025437h673.634633c5.191099-8.85456 8.475723-19.00024 8.475723-30.025437l7.975043-60.050874h22.050394v-30.025437H121.937575zM239.340362 760.646456c5.512599 31.433279 25.626826 57.294575 57.294575 57.294575H697.87307c31.667749 0 50.845121-25.392356 57.354984-57.294575l51.869007-302.892924h-619.686115l51.929416 302.892924z m146.373622-228.414482l21.231286-21.231286 90.310781 90.253444 90.310782-90.253444 21.228214 21.231286-90.310781 90.250372 90.604636 90.604636-21.231286 21.228215-90.601565-90.604637-90.604636 90.604637-21.228214-21.228215 90.602588-90.604636-90.311805-90.250372z"
                  fill="#EFD9A0"
                  p-id="2046"
                ></path>
                <path
                  d="M306.141858 413.762503a27.013167 57.402083 55.515 1 0 94.63014-65.001024 27.013167 57.402083 55.515 1 0-94.63014 65.001024Z"
                  fill="#FEFEFE"
                  p-id="2047"
                ></path>
                <path
                  d="M248.134573 508.228533a18.008095 31.51519 55.515 1 0 51.954332-35.687201 18.008095 31.51519 55.515 1 0-51.954332 35.687201Z"
                  fill="#FEFEFE"
                  p-id="2048"
                ></path>
              </svg>
            </div>

            <div class="select" style="transform: scale(0.8)">
              <el-select v-model="selectValue" @change="selectChange">
                <el-option
                  v-for="item in options"
                  :key="item.value"
                  :label="item.label"
                  :value="item.value"
                >
                </el-option>
              </el-select>
            </div>
          </div>
        </div>

        <div class="content" ref="canvasContent">
          <canvas
            v-show="isShowCnavas"
            :style="isOpacity ? 'background-color:rgba(0,0,0,0);' : null"
            ref="canvas"
            class="canvas"
            :width="canvasWpx * (sliderValue / 100)"
            :height="canvasHpx * (sliderValue / 100)"
          >
            你的浏览器不支持canvas，请升级浏览器或者使用Chrome/fixfor
          </canvas>
          <div
            class="clearRect"
            ref="clearRectDiv"
            style="
              display: none;
              position: absolute;
              border-radius: 50%;
              border: 1px solid gray;
              box-sizing: border-box;
              transform: translate(-50%, -50%);
            "
          ></div>
        </div>
      </div>
      <div class="box-right">
        <transition>
          <router-view></router-view>
        </transition>
      </div>
    </div>
  </div>
</template>

<script lang="ts">
import { Component, Vue, Ref, Watch } from 'vue-property-decorator'
import { Getter, Mutation } from 'vuex-class'
import '../style/components/canvas.scss'
@Component
export default class HelloWorld extends Vue {
  private options = [
    {
      value: '0',
      label: '连接房间'
    },
    {
      value: '1',
      label: '断开房间'
    }
  ];

  private selectValue = '是否进入房间';

  private clearRectDom: any;
  private timer: any;
  private ws: any;
  private isWsOpen = false;
  private reStartWsTimer: any;
  private isRestart = true;

  @Ref() private canvas!: any;
  @Ref() private canvasContent!: any;
  @Ref() private clearRectDiv!: any;

  @Watch('canvasWpx')
  handlerCanvasWpx (val: number) {
    this.updataCanvasPx({
      Wpx: val,
      Hpx: this.canvas.offsetHeight
    })
  }

  @Watch('canvasHpx')
  handlerCanvasHpx (val: number) {
    this.updataCanvasPx({
      Wpx: this.canvas.offsetWidth,
      Hpx: val
    })
  }

  @Watch('Image')
  handlerImage (val: any) {
    if (!val || val == null) return false
    this.ctx.clearRect(0, 0, this.canvas.offsetWidth, this.canvas.offsetHeight)
    this.ctx.drawImage(
      val,
      0,
      0,
      this.canvas.offsetWidth,
      this.canvas.offsetHeight
    )
  }

  @Getter('Image')
  private Image!: any;

  @Getter('lineWidth')
  private lineWidth!: number;

  @Getter('noOpacityValue')
  private noOpacityValue!: number;

  @Getter('canvasWpx')
  private canvasWpx!: number;

  @Getter('canvasHpx')
  private canvasHpx!: number;

  @Getter('isShowCnavas')
  private isShowCnavas!: number;

  @Getter('isOpacity')
  private isOpacity!: number;

  @Getter('strokeStyle')
  private strokeStyle!: any;

  @Getter('brush')
  private brush!: string;

  $store: any;
  get sliderValue () {
    return this.$store.state.canvasSizeSlider
  }

  set sliderValue (val: any) {
    this.$store.state.canvasSizeSlider = val
    this.updataCanvasPx({
      Wpx: this.canvas.offsetWidth,
      Hpx: this.canvas.offsetHeight
    })
  }

  @Mutation('updataCanvasPx')
  private updataCanvasPx!: any;

  private ctx: any;
  private x = 0;
  private y = 0;
  private imageDataArr: any = [];
  private step = 0;
  private userId = new Date().getTime();

  mounted () {
    this.init()
  }

  destroyed () {
    if (!this.ws) return false
    this.ws.close()
  }

  selectChange (val: any) {
    // eslint-disable-next-line eqeqeq
    if (val == 0) {
      this.initWebsocket()
      this.isRestart = true
      // eslint-disable-next-line eqeqeq
    } else if (val == 1) {
      if (!this.ws) return false
      this.ws.close()
      this.isRestart = false
    }
  }

  initWebsocket () {
    this.ws = new WebSocket('wss://192.168.124.7:8082')
    this.ws.onerror = () => {
      this.$message.error('错了哦，ws连接失败')
      this.isWsOpen = false
    }
    this.ws.onmessage = (message: any) => {
      const Img = new Image()
      if (this.canvas.width !== JSON.parse(message.data).width || this.canvas.height !== JSON.parse(message.data).height) {
        this.canvas.width = JSON.parse(message.data).width
        this.canvas.height = JSON.parse(message.data).height
      }
      this.$store.state.canvasSizeSlider = JSON.parse(message.data).sliderSize
      Img.src = JSON.parse(message.data).imageData
      Img.onload = () => {
        this.ctx.clearRect(0, 0, this.canvas.offsetWidth, this.canvas.offsetHeight)
        this.ctx.drawImage(Img, 0, 0, this.canvas.offsetWidth, this.canvas.offsetHeight)
      }
    }
    this.ws.onopen = () => {
      clearTimeout(this.reStartWsTimer)
      this.$message({
        message: 'ws连接成功',
        type: 'success'
      })
      this.isWsOpen = true
    }
    this.ws.onclose = () => {
      this.$message({
        message: '警告哦，webSocket断开连接',
        type: 'warning'
      })
      this.isWsOpen = false
      clearTimeout(this.reStartWsTimer)
      if (!this.isRestart) return false
      this.reStartWsTimer = setInterval(() => {
        this.initWebsocket()
      }, 2000)
    }
  }

  init () {
    this.ctx = this.canvas.getContext('2d')
    this.canvas.onmousedown = (e: any) => {
      this.ctx.beginPath()
      this.x =
        e.clientX - this.canvas.offsetLeft + this.canvasContent.scrollLeft
      this.y = e.clientY - this.canvas.offsetTop + this.canvasContent.scrollTop
      this.ctx.moveTo(this.x, this.y)
      this.ctx.strokeStyle = this.strokeStyle
      this.ctx.lineWidth = this.lineWidth
      this.ctx.strokeStyle = this.strokeStyle
      this.ctx.lineWidth = this.lineWidth
      this.ctx.globalAlpha = this.noOpacityValue / 100
      // eslint-disable-next-line eqeqeq
      if (this.brush == '断线笔') {
        this.ctx.setLineDash([this.lineWidth, this.lineWidth + 2]) // 虚线
        // eslint-disable-next-line eqeqeq
      } else if (this.brush == '记号笔') {
        this.ctx.setLineDash([])
      }
      this.canvas.onmousemove = (e: any) => {
        this.x =
          e.clientX - this.canvas.offsetLeft + this.canvasContent.scrollLeft
        this.y =
          e.clientY - this.canvas.offsetTop + this.canvasContent.scrollTop
        switch (this.brush) {
          case '橡皮擦':
            this.clearRectDiv.style.display = 'block'
            this.clearRectDiv.style.left =
              this.x + this.canvas.offsetLeft + 'px'
            this.clearRectDiv.style.top = this.y + this.canvas.offsetTop + 'px'
            this.clearRectDiv.style.width = this.lineWidth + 'px'
            this.clearRectDiv.style.height = this.lineWidth + 'px'
            this.clearRect()
            break
          case '记号笔':
            this.stroke()
            break
          case '断线笔':
            this.stroke()
            break
          case '圆':
            this.strokeArc()
            break
          case '实心圆':
            this.fillArc()
            break
          case '线':
            this.storkeLine()
            break
        }
        this.send()
      }
      window.onmouseup = () => {
        this.canvas.onmousemove = null
        window.onmouseup = null
        this.ctx.closePath()
        this.imageDataArr.push(
          this.ctx.getImageData(
            0,
            0,
            this.canvas.offsetWidth,
            this.canvas.offsetHeight
          )
        )
        this.step = this.imageDataArr.length - 1
        this.clearRectDiv.style.display = 'none'
      }
    }
  }

  // send ws
  send () {
    if (this.isWsOpen) {
      this.canvas.toBlob((blob: any) => {
        this.ws.send(
          JSON.stringify({
            userId: this.userId,
            width: this.canvas.width,
            height: this.canvas.height,
            sliderSize: this.sliderValue,
            imageData: this.canvas.toDataURL(blob.type)
          })
        )
      })
    }
  }

  // 画线
  stroke () {
    this.ctx.globalAlpha = this.noOpacityValue / 100
    this.ctx.lineTo(this.x, this.y)
    this.ctx.stroke()
  }

  // 清空画布
  clearCanvas () {
    this.ctx.clearRect(0, 0, this.canvas.offsetWidth, this.canvas.offsetHeight)
    this.send()
  }

  // 橡皮擦
  clearRect () {
    this.ctx.save()
    this.ctx.beginPath()
    this.ctx.arc(this.x, this.y, this.lineWidth / 2, 0, Math.PI * 2)
    this.ctx.clip()
    this.ctx.clearRect(
      this.x - this.lineWidth / 2,
      this.y - this.lineWidth / 2,
      this.lineWidth + 10,
      this.lineWidth + 10
    )
    this.ctx.restore()
    this.send()
  }

  // 画圆
  strokeArc () {
    this.ctx.beginPath()
    this.ctx.lineWidth = 1
    this.ctx.arc(this.x, this.y, this.lineWidth / 2, 0, Math.PI * 2)
    this.ctx.stroke()
    this.ctx.closePath()
  }

  // 画实心圆
  fillArc () {
    this.ctx.beginPath()
    this.ctx.lineWidth = 1
    this.ctx.arc(this.x, this.y, this.lineWidth / 2, 0, Math.PI * 2)
    this.ctx.fill()
    this.ctx.closePath()
  }

  // 画直线
  storkeLine () {
    this.ctx.globalAlpha = this.noOpacityValue / 100
    this.ctx.lineTo(this.x, this.y)
    this.ctx.stroke()
    this.ctx.closePath()
  }

  sliderChange () {
    if (this.imageDataArr.length <= 0) return
    this.ctx.putImageData(this.imageDataArr[this.step], 0, 0)
  }

  sliderInput () {
    this.send()
    this.onWatchWH()
  }

  // 监听高度宽度
  onWatchWH () {
    if (this.canvas.offsetWidth > this.canvasContent.offsetWidth) {
      this.canvasContent.classList.add('updataW')
    } else {
      this.canvasContent.classList.remove('updataW')
    }

    if (this.canvas.offsetHeight > this.canvasContent.offsetHeight) {
      this.canvasContent.classList.add('updataH')
    } else {
      this.canvasContent.classList.remove('updataH')
    }
  }

  last () {
    this.step--
    if (this.step < 0) {
      this.step = 0
      this.ctx.clearRect(
        0,
        0,
        this.canvas.offsetWidth,
        this.canvas.offsetHeight
      )
      return false
    }
    this.ctx.putImageData(this.imageDataArr[this.step], 0, 0)
    this.send()
  }

  next () {
    this.step++
    if (this.step > this.imageDataArr.length - 1) {
      this.step = this.imageDataArr.length - 1
      return false
    }
    this.ctx.putImageData(this.imageDataArr[this.step], 0, 0)
    this.send()
  }

  reduceSlider () {
    this.sliderValue -= 10
    this.timer = setTimeout(() => {
      this.sliderChange()
      this.onWatchWH()
      clearTimeout(this.timer)
    })
  }

  addSlider () {
    this.sliderValue += 10
    this.timer = setTimeout(() => {
      this.sliderChange()
      this.onWatchWH()
      clearTimeout(this.timer)
    })
  }
}
</script>
